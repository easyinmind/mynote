# 浏览器

## 浏览器内核
> 浏览器内核包含两部分 **渲染引擎** 、**js引擎**  
> **渲染引擎** 处理网页（html/css）的解析及渲染  
> **js引擎** 解释执行js代码

### 常见内核
> 理解概念
+ `Webkit` 苹果开源的浏览器内核（WebKit 是 KHTML 的分支）
  + 渲染引擎 `WebCore`
  + js引擎 `JavaScriptCore`
+ `Blink` 谷歌基于 Webkit 的组件 WebCore 开源
  + 渲染引擎 `WebCore`
  + js引擎 `V8`
+ `Trident` IE10及以下、其它双核浏览器使用的内核
+ `Gecko` 火狐使用的内核

### 一些关键字区别
+ **Webkit** 苹果基于 **KHTML** 开源的浏览器内核，包含渲染引擎 **WebCore** 和js引擎 **JavaScriptCore**
+ **Blink** 谷歌基于 **Webkit** 的渲染引擎 **WebCore** 并内置js引擎 **V8** 开源的浏览器内核
+ **Chromium** 是谷歌为了发展 **Google Chrome** 开启的免费开源软件项目，提供了用户界面，Blink渲染引擎和V8JavaScript引擎
+ **Google Chrome** 可以理解为非开源的 **Chromium**，Chromium相当于Google Chrome的先行版

## 浏览器架构发展
> 进程与线程

### 进程与线程
> 启动一个程序，系统会创建一块内存。内存里包含*代码*、*文件*、*运行中数据*、*主线程*，这样的一个运行环境叫做一个 **进程**。  
> **线程** 依赖于进程，进程是系统进行资源分配的最小单元，无所以线程无法单独的获取系统的资源，需要使用其所在的进程的资源。  
> *单个线程* 是串行执行任务的，在进程中开其 *多个线程* 并行处理任务，可以提高效率。

+ 多个线程之间可以共享进程中的数据。  
+ 线程出错会导致进程奔溃。  
+ 进程关闭时，系统会回收内存，包括因线程引起的内存泄漏。  
+ 多个进程之间相互独立，通过 *IPC* 通讯。

### 单进程浏览器
> 浏览器进程：*页面线程*、*网络线程*、*插件线程*等
>
浏览器最早是使用单进程，所有的功能放在一个进程里，这样的架构会有一些缺点：
+ 不安全：恶意的插件和脚本可以操作系统
+ 不稳定：一个线程（一个页面线程或者插件线程奔溃了）引起的问题会导致程序奔溃
+ 不流畅：页面线程的js串行执行会导致渲染滞后卡顿

### 早期多进程浏览器
> 将渲染和插件功能单独放在一个沙箱环境的进程中，不会相互影响
+ 主进程
  + 网络线程
  + IPC 管理
  + 显示渲染进程生成的图片
+ 渲染进程
  + 每个tab开启一个渲染进程
  + 负责渲染合成网页图片
  + 沙箱环境，没有读写硬盘和操作系统的权限
+ 插件进程
  + 每个插件开启一个插件进程
  + 沙箱环境

### 现在多进程浏览器
> 将*网络*、*GPU*等功能从主进程中剥离出来
+ 主进程（一个）
  + 负责用户交互，前进后退刷新等
  + 管理协调其他进程
+ 网络进程（一个）
  + 负责网络请求
+ GPU进程（一个）
  + 最早是为了渲染css3，3D
  + 现在为了绘制页面
+ 存储进程（一个）
+ 备用渲染进程（一个）
+ 渲染进程（多个）
  + 解析渲染 *html、css、js*
  + *Blink、v8* 的副本都存在于渲染进程
+ 插件进程（多个）
  + 每个插件开启一个
+ 扩展进程（多个）
  + 每个扩展开启一个

缺点：**复杂、占用内存**

## 总结
主要记录了一些概念及浏览器的组成，后续会补充 *导航* 及 *渲染* 相关内容，主要有如下：
1. 导航阶段
   1. 传输阶段
   2. 缓存查询
2. 渲染阶段